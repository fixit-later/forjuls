<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Envelope Animation</title>

  <style>
    *{margin:0;padding:0;box-sizing:border-box}

    body{
      min-height:100vh;width:100%;
      display:flex;justify-content:center;align-items:center;
      font-family:'Playfair Display','Georgia',serif;
      background:linear-gradient(180deg,#fde6ee,#fff6e8);
      overflow:hidden;
    }

    /* ===== ENVELOPE ===== */
    .wrapper{height:200px;width:300px;position:relative;display:flex;justify-content:center;perspective:1000px;transition:transform 1s cubic-bezier(.22,.61,.36,1), opacity .6s ease;cursor:pointer}
    .lid{position:absolute;height:100%;width:100%;top:0;left:0;border-right:150px solid transparent;border-bottom:100px solid transparent;border-left:150px solid transparent;transform-origin:top;transform-style:preserve-3d;backface-visibility:hidden;transition:transform .55s cubic-bezier(.22,.61,.36,1)}
    .lid.one{border-top:100px solid #f9f7f3;z-index:3;transition-delay:.75s}
    .lid.two{border-top:100px solid #f9f7f3;transform:rotateX(90deg);z-index:1;transition-delay:.5s}
    .envelope{position:absolute;height:100%;width:100%;top:0;left:0;border-top:100px solid transparent;border-right:150px solid #f9f7f3;border-bottom:100px solid #f2efe9;border-left:150px solid #f5f2ec;z-index:3;background-image:radial-gradient(rgba(0,0,0,.03) 1px, transparent 1px);background-size:6px 6px;filter:brightness(.98)}
    .wrapper.open .envelope{pointer-events:none}
    .letter{position:absolute;top:0;width:80%;height:80%;background:#fff;border-radius:15px;z-index:2;transition:transform .5s ease;display:flex;align-items:center;justify-content:center;pointer-events:none}
    .wrapper.open .letter{pointer-events:auto}
    .letter-content{display:flex;flex-direction:column;align-items:center}
    .letter p{font-size:30px;color:#3B4049;margin-bottom:14px}
    .open-letter{border:none;background:linear-gradient(180deg,#ff6f91,#ff9aa2);color:#fff;padding:6px 14px;border-radius:999px;font-size:12px;font-weight:600;box-shadow:0 6px 12px rgba(0,0,0,.18);cursor:pointer}
    .seal{position:absolute;top:50%;left:50%;transform:translate(-50%,-30%);font-size:28px;z-index:5;pointer-events:none;animation:pulse 2s ease-in-out infinite}
    @keyframes pulse{0%{transform:translate(-50%,-30%) scale(1)}50%{transform:translate(-50%,-30%) scale(1.08)}100%{transform:translate(-50%,-30%) scale(1)}}
    .wrapper.open .lid.one{transform:rotateX(90deg);transition-delay:0s}
    .wrapper.open .lid.two{transform:rotateX(180deg);transition-delay:.25s}
    .wrapper.open .letter{transform:translateY(-70px) scale(1.02);transition-delay:.5s}
    .wrapper.open .seal{opacity:0;animation:none}
    .wrapper.exit{transform:translateY(180px);opacity:0;pointer-events:none}

    /* ===== PAPER PAGE ===== */
    .paper-page{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .6s ease;z-index:10;background:linear-gradient(180deg,#fde6ee,#fff6e8)}
    body.show-paper .paper-page{opacity:1;pointer-events:auto}

    /* iPhone canvas */
    .paper{
      width:100%;max-width:390px;
      height:100%;max-height:844px;
      background:linear-gradient(180deg,#ffffff 0%,#fff7fa 100%);
      padding:48px 24px 40px;
      text-align:center;
      display:flex;flex-direction:column;align-items:center;
    }

    .paper h1{font-size:34px;font-weight:600;margin:8px 0;color:#1c1c1e}
    .paper p{font-size:22px;margin:8px 0 20px;color:#ff2d55}
    .valentine-gif{width:260px;max-width:80%;border-radius:16px;margin:12px 0}

    /* ===== BUTTON ZONE (LOCKED) ===== */
    .buttons{
      margin-top:auto;
      width:100%;
      display:flex;
      flex-direction:column;
      gap:16px;
      align-items:center;
      position:relative;
      padding-bottom:32px;
    }

    .yes{
      width:80%;max-width:280px;
      padding:16px;border-radius:999px;border:none;
      background:#ff2d55;color:#fff;
      font-size:17px;font-weight:600;
      animation:yesPulse 2.2s ease-in-out infinite;
      position:relative;z-index:2;
    }

    .yes.highlight{
      box-shadow:0 0 0 0 rgba(255,45,85,.6);
      animation:highlightPulse 1.2s ease-in-out infinite;
    }

    @keyframes yesPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.04)}}
    @keyframes highlightPulse{0%{box-shadow:0 0 0 0 rgba(255,45,85,.6)}70%{box-shadow:0 0 0 18px rgba(255,45,85,0)}100%{box-shadow:0 0 0 0 rgba(255,45,85,0)}}

    .no{
      width:80%;max-width:280px;
      padding:14px;border-radius:999px;
      border:1px solid #ffd1dc;background:#fff;color:#ff2d55;
      font-size:16px;font-weight:600;
      position:absolute;
      top:100%;
      margin-top:12px;
      left:50%;
      transform:translateX(-50%);
      z-index:1;
      transition:transform .35s cubic-bezier(.25,.8,.25,1);
    }

    .no.surrender{animation:shake .35s ease-in-out 2}
    @keyframes shake{0%{transform:translate(-50%,0)}25%{transform:translate(-54%,0)}50%{transform:translate(-46%,0)}75%{transform:translate(-52%,0)}100%{transform:translate(-50%,0)}}

    /* ===== CELEBRATION ===== */
    .celebrate{position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;background:linear-gradient(180deg,#ffdde7,#fff6f9);z-index:20;opacity:0;pointer-events:none;transition:opacity .5s ease}
    body.show-celebrate .celebrate{opacity:1;pointer-events:auto}

    .emoji-rain{position:fixed;inset:0;overflow:hidden;pointer-events:none}
    .emoji{position:absolute;font-size:24px;animation:fall 3.5s linear infinite}
    @keyframes fall{from{transform:translateY(-10vh);opacity:1}to{transform:translateY(110vh);opacity:0}}
  </style>
</head>
<body>

  <div class="wrapper" id="wrapper">
    <div class="lid one"></div>
    <div class="lid two"></div>
    <div class="envelope"></div>
    <div class="seal">ðŸ’–</div>
    <div class="letter">
      <div class="letter-content">
        <p>Hi Juls</p>
        <button class="open-letter" id="continueBtn">Click here ðŸ’Œ</button>
      </div>
    </div>
  </div>

  <div class="paper-page">
    <div class="paper">
      <img class="valentine-gif" src="https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExNnRuOGhid3dpeW5pbjEwanV2OWx6amppMjB0Ynh2c2c2MTg3NGp6MCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/MDJ9IbxxvDUQM/giphy.gif" />
      <h1>Hi Juls</h1>
      <p>Will you be my Valentine? ðŸ’–</p>
      <div class="buttons">
        <button class="yes">Yes ðŸ’—</button>
        <button class="no" id="noBtn">No</button>
      </div>
    </div>
  </div>

  <div class="celebrate">
    <h1>SHE SAID YES ðŸ’–</h1>
    <div class="emoji-rain" id="emojiRain"></div>
  </div>

  <script>
    const wrapper = document.getElementById('wrapper');
    const continueBtn = document.getElementById('continueBtn');
    const yesBtn = document.querySelector('.yes');
    const noBtn = document.getElementById('noBtn');

    wrapper.addEventListener('click', e => {
      if (e.target.closest('.letter')) return;
      wrapper.classList.add('open');
    }, { once:true });

    continueBtn.addEventListener('click', e => {
      e.stopPropagation();
      wrapper.classList.add('exit');
      setTimeout(() => {
        document.body.classList.add('show-paper');
        wrapper.style.display = 'none';

        // NO stays in normal flow under YES (CSS-controlled)
      }, 600);
    }, { once:true });

    let dodgeCount = 0;
    const MAX_DODGES = 7;

    function moveNo(e){
      e.preventDefault();

      if(dodgeCount >= MAX_DODGES){
        noBtn.textContent = 'okay okay ðŸ˜³';
        noBtn.classList.add('surrender');
        yesBtn.classList.add('highlight');
        noBtn.removeEventListener('click', moveNo);
        noBtn.removeEventListener('touchstart', moveNo);
        return;
      }

      dodgeCount++;

      const paper = document.querySelector('.paper');
      const paperRect = paper.getBoundingClientRect();
      const noRect = noBtn.getBoundingClientRect();
      const yesRect = yesBtn.getBoundingClientRect();
      const pad = 16;

      let x, y;
      do{
        x = pad + Math.random() * (paperRect.width - noRect.width - pad*2);
        y = (yesRect.bottom - paperRect.top) + 40 + Math.random() * 140;
      } while(
        x < yesRect.left - paperRect.left + noRect.width &&
        x + noRect.width > yesRect.left - paperRect.left &&
        y < yesRect.bottom - paperRect.top &&
        y + noRect.height > yesRect.top - paperRect.top
      );

      noBtn.style.transform = `translate(${x - paperRect.width/2}px, ${y}px)`;
    }

    noBtn.addEventListener('click', moveNo);
    noBtn.addEventListener('touchstart', moveNo, { passive:false });

    yesBtn.addEventListener('click', () => {
      document.querySelector('.paper-page').style.opacity = '0';
      setTimeout(() => {
        document.body.classList.add('show-celebrate');
        startEmojiRain();
      }, 400);
    }, { once:true });

    function startEmojiRain(){
      const rain = document.getElementById('emojiRain');
      const hearts = ['ðŸ’–','ðŸ’—','ðŸ’˜','ðŸ’•','ðŸ’ž'];
      rain.innerHTML = '';
      for(let i=0;i<40;i++){
        const span = document.createElement('span');
        span.className = 'emoji';
        span.textContent = hearts[Math.floor(Math.random()*hearts.length)];
        span.style.left = Math.random()*100 + 'vw';
        span.style.animationDelay = Math.random()*3 + 's';
        span.style.fontSize = 18 + Math.random()*14 + 'px';
        rain.appendChild(span);
      }
    }
  </script>

</body>
</html>
